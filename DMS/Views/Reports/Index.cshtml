


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
    <title>DataTables Example</title>
    <style>
        .btn {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2>Disaster Reports</h2>
        <form id="reportForm" method="get" action="/Reports/GenerateDisasterReport">
            <div class="form-group">
                <label for="disasterType">Disaster Type:</label>
                <select class="form-control" id="disasterType" name="disasterType">
                    <option value="All">All</option>
                    <option value="Earthquake">Earthquake</option>
                    <option value="Flood">Flood</option>
                    <option value="Fire">Fire</option>
                </select>
            </div>
            <div class="form-group">
                <label for="startDate">Start Date:</label>
                <input type="date" class="form-control" id="startDate" name="startDate">
            </div>
            <div class="form-group">
                <label for="endDate">End Date:</label>
                <input type="date" class="form-control" id="endDate" name="endDate">
            </div>
            <button type="submit" class="btn btn-primary">Generate Report</button>
        </form>

        <div class="mt-3">
            <button id="exportExcel" class="btn btn-success">Export to Excel</button>
            <button id="exportPDF" class="btn btn-danger">Export to PDF</button>
        </div>

        <!-- DataTable for displaying results -->
        <table id="disasterTable" class="display mt-4" style="width:100%">
            <thead>
                <tr>
                    <th>Disaster Type</th>
                    <th>Date</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody class="reportBody">
                <!-- Data will be populated here -->
            </tbody>
        </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Avoid conflicts with other libraries
        jQuery.noConflict();
        jQuery(document).ready(function ($) {
            // Initialize DataTable
            var table = $('#disasterTable').DataTable();

            // Handle form submission
            $('#reportForm').on('submit', function (e) {
                e.preventDefault(); // Prevent the default form submission

                var formData = $(this).serialize(); // Serialize form data

                $.ajax({
                    url: $(this).attr('action'),
                    type: 'GET',
                    data: formData,
                    success: function (data) {
                        console.log(data); // Log the response
                        table.clear(); // Clear existing data

                        // Populate the table with new data
                        if (Array.isArray(data) && data.length > 0) {
                            $.each(data, function (index, disaster) {
                                table.row.add([
                                    disaster.type,
                                    new Date(disaster.date).toLocaleDateString(), // Format the date
                                    '<a href="#" class="btn btn-info">View</a>'
                                ]).draw();
                            });
                        } else {
                            table.row.add(['No records found', '', '']).draw();
                        }
                    },
                    error: function (xhr) {
                        alert('An error occurred while fetching disaster reports.');
                    }
                });
            });

            // Export to Excel
            $('#exportExcel').on('click', function () {
                var data = table.rows().data().toArray();
                var ws = XLSX.utils.json_to_sheet(data.map(row => ({
                    'Disaster Type': row[0],
                    'Date': row[1],
                    'Details': row[2]
                })));
                var wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Reports');
                XLSX.writeFile(wb, 'disaster_reports.xlsx');
            });

            // Export to PDF
            $('#exportPDF').on('click', function () {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(12);
                doc.text('Disaster Reports', 14, 22);
                const tableData = table.rows().data().toArray();

                const headers = [['Disaster Type', 'Date', 'Details']];
                const data = tableData.map(row => [row[0], row[1], row[2]]);

                doc.autoTable({
                    head: headers,
                    body: data,
                    startY: 30,
                });

                doc.save('disaster_reports.pdf');
            });
        });
    </script>
</body>
</html>


